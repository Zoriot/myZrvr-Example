name: Deploy Infrastructure - Production

on:
  push:
    branches: [ "prod" ]

jobs:
  build-terra:
    runs-on: ubuntu-latest
    environment: prod   # Caller repo's environment (approvals + secrets)
    steps:
      - uses: actions/checkout@v4
      - name: Build Terra Docker image
        # This action builds and pushes the Docker image for Terra
        # It is assumed that the action is defined in the Zrvr repository
        uses: Zoriot/Zrvr/.github/actions/build@dev
        with:
          service: Terra
          environment: prod
      - name: Deploy Terra Docker image
        uses: Zoriot/Zrvr/.github/actions/deploy@dev
        with:
          compose-file: docker-compose-prod.yml
    permissions:
      contents: read
      packages: write
      id-token: write
